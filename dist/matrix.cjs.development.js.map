{"version":3,"file":"matrix.cjs.development.js","sources":["../src/matrix.ts"],"sourcesContent":["import { Robot, Adapter, Envelope, TextMessage, User } from \"hubot\";\nimport {\n  ClientEvent,\n  ISendEventResponse,\n  MatrixClient,\n  RoomEvent,\n  RoomMemberEvent,\n} from \"matrix-js-sdk\";\n\nimport sdk from \"matrix-js-sdk\";\nimport request from \"request\";\nimport sizeOf from \"image-size\";\nimport { makeHtmlNotice, makeNotice } from \"matrix-js-sdk/lib/content-helpers\";\nimport { Parser, HtmlRenderer } from \"commonmark\";\n\n/**\n * The Matrix-specific metadata available about a message.\n */\nexport type MatrixMessageMetadata = {\n  readonly threadId?: string;\n  readonly interpretMarkdown?: boolean;\n};\n\n/**\n * Represents a regular Hubot TextMessage with additional Matrix metadata.\n */\nexport class MatrixMessage extends TextMessage {\n  constructor(\n    user: User,\n    text: string,\n    id: string,\n    public metadata: MatrixMessageMetadata\n  ) {\n    super(user, text, id);\n  }\n}\n\nexport class Matrix extends Adapter {\n  public client: MatrixClient | undefined;\n  private user_id: string | undefined;\n  private access_token: string | undefined;\n  private device_id: string | undefined;\n\n  private commonMarkReader = new Parser();\n  private commonMarkRenderer = new HtmlRenderer({ safe: true, softbreak: \"<br />\" });\n\n  constructor(private robot: Robot<Matrix>) {\n    super(robot);\n    this.robot.logger.info(\"Constructor\");\n  }\n\n  handleUnknownDevices(err: { devices: { [x: string]: any } }) {\n    return (() => {\n      let result = [];\n      for (var stranger in err.devices) {\n        var devices = err.devices[stranger];\n        result.push(\n          (() => {\n            let result1 = [];\n            for (let device in devices) {\n              this.robot.logger.info(\n                `Acknowledging ${stranger}'s device ${device}`\n              );\n              result1.push(this.client?.setDeviceKnown(stranger, device));\n            }\n            return result1;\n          })()\n        );\n      }\n      return result;\n    })();\n  }\n\n  send(envelope: Envelope, ...strings: any[]) {\n    return strings.map((str) => this.sendThreaded(envelope, undefined, str));\n  }\n\n  async resolveRoom(room: string): Promise<string> {\n    const roomFromId = this.client?.getRoom(room)\n    if (roomFromId !== null && roomFromId !== undefined) {\n      return room\n    }\n\n    const roomIdFromAlias = (await this.client?.getRoomIdForAlias(room))?.room_id\n    if (roomIdFromAlias === undefined) {\n      throw new Error(`Failed to resolve specified room: ${room}.`)\n    }\n\n    return roomIdFromAlias\n  }\n\n  async sendThreaded(\n    envelope: Envelope,\n    threadId: string | undefined,\n    message: string\n  ): Promise<ISendEventResponse | undefined> {\n    const resolvedRoom = await this.resolveRoom(envelope.room)\n\n    const interpretMarkdown =\n      \"metadata\" in (envelope.message ?? {})\n        ? (envelope.message as MatrixMessage).metadata.interpretMarkdown ?? true\n        : true;\n\n    const finalMessage = interpretMarkdown\n      ? makeHtmlNotice(\n          message,\n          this.commonMarkRenderer.render(this.commonMarkReader.parse(message))\n        )\n      : makeNotice(message);\n\n    this.robot.logger.info(`Sending to ${envelope.room} (resolved to ${resolvedRoom}): ${message}`);\n    if (/^(f|ht)tps?:\\/\\//i.test(message)) {\n      return this.sendURL(envelope, message);\n    }\n    if (threadId !== undefined) {\n      return this.client\n        ?.sendMessage(resolvedRoom, threadId, finalMessage)\n        ?.catch((err) => {\n          if (err.name === \"UnknownDeviceError\") {\n            this.handleUnknownDevices(err);\n            return this.client?.sendMessage(\n              resolvedRoom,\n              threadId,\n              finalMessage\n            );\n          }\n        });\n    }\n    return this.client\n      ?.sendMessage(resolvedRoom, finalMessage)\n      .catch((err) => {\n        if (err.name === \"UnknownDeviceError\") {\n          this.handleUnknownDevices(err);\n          return this.client?.sendMessage(resolvedRoom, finalMessage);\n        }\n      });\n  }\n\n  async emote(envelope: Envelope, ...strings: string[]) {\n    const resolvedRoom = await this.resolveRoom(envelope.room)\n\n    return Array.from(strings).map((str) =>\n      this.client?.sendEmoteMessage(resolvedRoom, str).catch((err) => {\n        if (err.name === \"UnknownDeviceError\") {\n          this.handleUnknownDevices(err);\n          return this.client?.sendEmoteMessage(resolvedRoom, str);\n        }\n      })\n    );\n  }\n\n  reply(envelope: Envelope, ...strings: string[]) {\n    const threadId =\n      \"metadata\" in envelope.message\n        ? (envelope.message as MatrixMessage).metadata.threadId\n        : undefined;\n\n    return Array.from(strings).map((str) =>\n      this.sendThreaded(envelope, threadId, `${envelope.user.name}: ${str}`)\n    );\n  }\n\n  topic(envelope: Envelope, ...strings: string[]) {\n    return Array.from(strings).map((str) =>\n      this.client?.sendStateEvent(\n        envelope.room,\n        \"m.room.topic\",\n        {\n          topic: str,\n        },\n        \"\"\n      )\n    );\n  }\n\n  async sendURL(\n    envelope: Envelope,\n    url: string\n  ): Promise<ISendEventResponse | undefined> {\n    const resolvedRoom = await this.resolveRoom(envelope.room)\n\n    this.robot.logger.info(`Downloading ${url}`);\n    return new Promise((resolve, reject) => {\n      request({ url, encoding: null }, (error, response, body) => {\n        if (error) {\n          this.robot.logger.info(`Request error: ${JSON.stringify(error)}`);\n          reject(error);\n        } else if (response.statusCode === 200) {\n          let info: sdk.IImageInfo;\n          try {\n            let dims = sizeOf(body);\n            this.robot.logger.info(\n              `Image has dimensions ${JSON.stringify(dims)}, size ${\n                body.length\n              }`\n            );\n            if (dims.type === \"jpg\") {\n              dims.type = \"jpeg\";\n            }\n            info = {\n              mimetype: `image/${dims.type}`,\n              h: dims.height,\n              w: dims.width,\n              size: body.length,\n            };\n            resolve(\n              this.client\n                ?.uploadContent(body, {\n                  name: url,\n                  type: info.mimetype,\n                  rawResponse: false,\n                  onlyContentUri: true,\n                })\n                .then((content_uri) => {\n                  return this.client\n                    ?.sendImageMessage(resolvedRoom, content_uri, info, url)\n                    .catch((err) => {\n                      if (err.name === \"UnknownDeviceError\") {\n                        this.handleUnknownDevices(err);\n                        return this.client?.sendImageMessage(\n                          resolvedRoom,\n                          content_uri,\n                          info,\n                          url\n                        );\n                      }\n                    });\n                })\n            );\n          } catch (error1) {\n            error = error1;\n            this.robot.logger.info(error.message);\n            resolve(this.sendThreaded(envelope, undefined, ` ${url}`));\n          }\n        }\n      });\n    });\n  }\n\n  run() {\n    this.robot.logger.info(`Run ${this.robot.name}`);\n    if (process.env.HUBOT_MATRIX_ACCESS_TOKEN) {\n      this.robot.logger.info(\"Login by access token\");\n      this.user_id = process.env.HUBOT_MATRIX_USER;\n      this.access_token = process.env.HUBOT_MATRIX_ACCESS_TOKEN;\n      this.access();\n    } else {\n      this.robot.logger.info(\"Login by password\");\n      let client = sdk.createClient({\n        baseUrl: process.env.HUBOT_MATRIX_HOST_SERVER || \"https://matrix.org\",\n        request: request,\n      });\n      return client.login(\n        \"m.login.password\",\n        {\n          user: process.env.HUBOT_MATRIX_USER || this.robot.name,\n          password: process.env.HUBOT_MATRIX_PASSWORD,\n        },\n        (\n          err: any,\n          data: { user_id: string; access_token: string; device_id: string }\n        ) => {\n          if (err) {\n            this.robot.logger.error(err);\n            return;\n          }\n          this.user_id = data.user_id;\n          this.access_token = data.access_token;\n          this.device_id = data.device_id;\n          this.access();\n        });\n    }\n  }\n\n  access() {\n    this.robot.logger.info(\n      `Logged in ${this.user_id} on device ${this.device_id}`\n    );\n    this.client = sdk.createClient({\n      baseUrl: process.env.HUBOT_MATRIX_HOST_SERVER || \"https://matrix.org\",\n      accessToken: this.access_token,\n      userId: this.user_id,\n      deviceId: this.device_id,\n      request,\n    });\n    this.client?.on(ClientEvent.Sync, (state) => {\n      switch (state) {\n        case \"PREPARED\":\n          this.robot.logger.info(\n            `Synced ${this.client?.getRooms().length} rooms`\n          );\n          // We really don't want to let people set the display name to something other than the bot\n          // name because the bot only reacts to it's own name.\n          const currentDisplayName = this.client?.getUser(\n            this.user_id ?? \"\"\n          )?.displayName;\n          if (this.robot.name !== currentDisplayName) {\n            this.robot.logger.info(\n              `Setting display name to ${this.robot.name}`\n            );\n            this.client?.setDisplayName(this.robot.name, () => {});\n          }\n          return this.emit(\"connected\");\n      }\n    });\n    this.client?.on(\n      RoomEvent.Timeline,\n      (event, room, toStartOfTimeline) => {\n        if (\n          event.getType() === \"m.room.message\" &&\n          toStartOfTimeline === false\n        ) {\n          this.client?.setPresence({ presence: \"online\" });\n          let id = event.getId();\n          let message = event.getContent();\n          let name = event.getSender();\n          let user = this.robot.brain.userForId(name);\n          user.room = room.getCanonicalAlias() ?? room.roomId;\n          if (name !== this.user_id) {\n            this.robot.logger.info(\n              `Received message: ${JSON.stringify(message)} in room: ${\n                user.room\n              }, from: ${user.name} (${user.id}).`\n            );\n            if (message.msgtype === \"m.text\") {\n              const messageThreadId = event.threadRootId ?? id;\n\n              this.receive(\n                new MatrixMessage(user, message.body, id, {\n                  threadId: messageThreadId,\n                })\n              );\n            }\n            if (\n              message.msgtype !== \"m.text\" ||\n              message.body.indexOf(this.robot.name) !== -1\n            ) {\n              return this.client?.sendReadReceipt(event);\n            }\n          }\n        }\n      }\n    );\n    this.client?.on(RoomMemberEvent.Membership, async (event, member) => {\n      if (\n        member.membership === \"invite\" &&\n        member.userId === this.user_id\n      ) {\n        await this.client?.joinRoom(member.roomId);\n        this.robot.logger.info(`Auto-joined ${member.roomId}`);\n      }\n    });\n    return this.client?.startClient({ initialSyncLimit: 0 });\n  }\n}\n\nexport function use(robot: Robot<any>): Matrix {\n  return new Matrix(robot);\n}\n"],"names":["MatrixMessage","user","text","id","metadata","TextMessage","Matrix","robot","client","user_id","access_token","device_id","commonMarkReader","Parser","commonMarkRenderer","HtmlRenderer","safe","softbreak","logger","info","handleUnknownDevices","err","result","stranger","devices","push","result1","device","setDeviceKnown","send","envelope","strings","map","str","sendThreaded","undefined","resolveRoom","room","roomFromId","getRoom","getRoomIdForAlias","room_id","roomIdFromAlias","Error","threadId","message","resolvedRoom","interpretMarkdown","finalMessage","makeHtmlNotice","render","parse","makeNotice","test","sendURL","sendMessage","name","emote","Array","from","sendEmoteMessage","reply","topic","sendStateEvent","url","Promise","resolve","reject","request","encoding","error","response","body","JSON","stringify","statusCode","dims","sizeOf","length","type","mimetype","h","height","w","width","size","uploadContent","rawResponse","onlyContentUri","then","content_uri","sendImageMessage","error1","run","process","env","HUBOT_MATRIX_ACCESS_TOKEN","HUBOT_MATRIX_USER","access","sdk","createClient","baseUrl","HUBOT_MATRIX_HOST_SERVER","login","password","HUBOT_MATRIX_PASSWORD","data","accessToken","userId","deviceId","on","ClientEvent","Sync","state","getRooms","currentDisplayName","getUser","displayName","setDisplayName","emit","RoomEvent","Timeline","event","toStartOfTimeline","getType","setPresence","presence","getId","getContent","getSender","brain","userForId","getCanonicalAlias","roomId","msgtype","messageThreadId","threadRootId","receive","indexOf","sendReadReceipt","RoomMemberEvent","Membership","member","membership","joinRoom","startClient","initialSyncLimit","Adapter","use"],"mappings":"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"}